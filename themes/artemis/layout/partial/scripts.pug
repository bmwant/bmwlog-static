//- LaTex
if theme.mathjax
    script(async, src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML', integrity='sha384-Ra6zh6uYMmH5ydwCqqMoykyf1T/+ZcnOQfFPhDrp2kI4OIxadnhsvvA2vv9A7xYv', crossorigin='anonymous')
    script(type='text/x-mathjax-config')
        | MathJax.Hub.Config({
        |   tex2jax: {
        |       inlineMath: [['$','$'],['\\(','\\)']],
        |       processClass: "mathjax",
        |       ignoreClass: "no-mathjax"
        |   }
        | });

//- Analytics tracking
if theme.google_analytics
    script(async, src=`https://www.googletagmanager.com/gtag/js?id=${theme.google_analytics}`)
    script.
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', '#{theme.google_analytics}');

script.
  var fuckrussia = false;  // TODO: this actually should be true everywhere
  if (window.navigator.language !== undefined && window.navigator.language.toLowerCase().includes('ru')) {
    fuckrussia = true;
  }

  if (window.navigator.userLanguage !== undefined && window.navigator.userLanguage.toLowerCase().includes('ru')) {
    fuckrussia = true;
  }

  var hasrulang = window.navigator.languages.map(x => x.toLowerCase()).map(x => x.includes('ru'));
  if (hasrulang.includes(true)) {
    fuckrussia = true;
  }

  if (fuckrussia && window.location.pathname !== '/') {
    window.location.href = '/';
  }

// Theme toggle script
script.
  (function() {
    var body = document.body;
    var toggleButton = document.getElementById('theme-toggle-button');

    if (!toggleButton) {
      console.error('Theme toggle button not found');
      return;
    }

    // Function to apply the theme based on localStorage
    function applyInitialTheme() {
      var storedTheme = localStorage.getItem('theme');
      if (storedTheme === 'dark') {
        body.classList.add('dark-mode');
      } else {
        body.classList.remove('dark-mode'); // Explicitly set light by removing dark
      }
    }

    // Apply theme on initial load
    applyInitialTheme();

    // Event listener for the toggle button
    toggleButton.addEventListener('click', function(event) {
      event.preventDefault(); // If using an <a> tag for the button
      body.classList.toggle('dark-mode');

      // Update localStorage
      if (body.classList.contains('dark-mode')) {
        localStorage.setItem('theme', 'dark');
      } else {
        localStorage.setItem('theme', 'light');
      }
    });
  })();

